<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meal Report</title>
    <link rel="stylesheet" href="../../css/globals.css">
    <link rel="stylesheet" href="../../css/reports/meal_report.css">
    <!--Has a report displaying your meal data and recommendations on that data-->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <h1>Meal Tracker Dashboard</h1>
  
    <div class="chart-container">
      <h2>Calories Over Time</h2>
      <canvas id="calorieChart"></canvas>
    </div>
  
    <div class="chart-container">
      <h2>Nutrient Totals</h2>
      <canvas id="nutrientChart"></canvas>
    </div>
  
    <div class="chart-container">
      <h2>Meal Type Distribution</h2>
      <canvas id="mealTypeChart"></canvas>
    </div>
  
    <script>
      fetch('/meal-data')
        .then(res => res.json())
        .then(data => {
          const dates = data.map(entry => entry.mealDate);
          const calories = data.map(entry => entry.calories);
          const proteins = data.map(entry => entry.protein);
          const carbs = data.map(entry => entry.carbs);
          const fats = data.map(entry => entry.fats);
          const mealTypes = data.map(entry => entry.mealType);
  
          // Calorie Line Chart
          new Chart(document.getElementById('calorieChart'), {
            type: 'line',
            data: {
              labels: dates,
              datasets: [{
                label: 'Calories (kcal)',
                data: calories,
                borderColor: 'rgba(255, 159, 64, 1)',
                backgroundColor: 'rgba(255, 159, 64, 0.2)',
                fill: true,
                tension: 0.3
              }]
            },
            options: {
              responsive: true,
              scales: {
                y: {
                  beginAtZero: true
                }
              }
            }
          });
  
          // Macronutrient Totals
          const totalProtein = proteins.reduce((a, b) => a + b, 0);
          const totalCarbs = carbs.reduce((a, b) => a + b, 0);
          const totalFats = fats.reduce((a, b) => a + b, 0);
  
          new Chart(document.getElementById('nutrientChart'), {
            type: 'bar',
            data: {
              labels: ['Protein (g)', 'Carbs (g)', 'Fats (g)'],
              datasets: [{
                label: 'Total Intake',
                data: [totalProtein, totalCarbs, totalFats],
                backgroundColor: [
                  'rgba(75, 192, 192, 0.6)',
                  'rgba(255, 206, 86, 0.6)',
                  'rgba(255, 99, 132, 0.6)'
                ]
              }]
            },
            options: {
              responsive: true,
              scales: {
                y: { beginAtZero: true }
              }
            }
          });
  
          // Meal Type Distribution
          const typeCounts = mealTypes.reduce((acc, type) => {
            acc[type] = (acc[type] || 0) + 1;
            return acc;
          }, {});
          const mealTypeLabels = Object.keys(typeCounts);
          const mealTypeData = Object.values(typeCounts);
  
          new Chart(document.getElementById('mealTypeChart'), {
            type: 'doughnut',
            data: {
              labels: mealTypeLabels,
              datasets: [{
                data: mealTypeData,
                backgroundColor: [
                  '#36A2EB', '#FFCE56', '#FF6384', '#8E44AD'
                ]
              }]
            },
            options: {
              responsive: true
            }
          });
        })
        .catch(err => console.error('Error fetching meal data:', err));
    </script>

</body>
</html>
